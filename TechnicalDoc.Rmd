---
title: Including health impacts in transport modelling and economic appraisal-ITHIM
  Melbourne
author: "Belen Zapata-Diomedi, belen.zapata-diomedi@rmit.edu.au, Alan Both, alan.both@rmit.edu.au"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  word_document:
  html_document:
    df_print: paged
  pdf_document: default
header-includes:
- \usepackage{caption}
- \usepackage{pdflscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
biblio-style: apsr
subtitle: '*Technical appendix*'
always_allow_html: yes
bibliography: DoT.bib
---
<style type="text/css">
.main-container {
  max-width: 1800px;
  margin-left: auto;
  margin-right: auto;
}
body{
  font-family: Calibri;
  font-size: 12pt;
}
h1,h2,h3,h4,h5,h6{
  font-size: 24pt;
}
</style>


```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(echo = TRUE, width = 100)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r, include=FALSE}
options(tinytex.verbose = TRUE)
```

```{r Libraries, echo = FALSE, message = FALSE, warning = FALSE}
library(knitr)
library(kableExtra)
library(dplyr)
library(tidyr)
library(tibble) 
library(knitr)
library(DiagrammeR)
library(svglite)
library(png)
library(tinytex)
library(png)
library(DiagrammeRsvg)
library(rsvg)
library(pander)
options(scipen = 999)


## Pander options tables
panderOptions('table.alignment.default', function(df)
    ifelse(sapply(df, is.numeric), 'right', 'left'))
panderOptions('table.split.table', Inf)
panderOptions('big.mark', ",")
panderOptions('keep.trailing.zeros', TRUE)
```

## Contents

1. Introduction
2. Methods
3. References


\newpage

# 1. Introduction

In Australia in 2015, physical inactivity contributed to 20% of the disease burden (mortality and morbidity) from diabetes, some types of cancer (bowel, uterine, breast), dementia and cardiovascular diseases [@RN28]. And overall, physical inactivity was responsible for 2.5% of the total burden with 55% of the adult population (18 years of age and older) not meeting the National Physical Activity guidelines.[@RN28]. 

In Melbourne, a small proportion of trips are made by active modes (walking and cycling) compared to the private car (driver, passenger and taxi) (Figure 1, (analysis of VISTA survey [@RN20])). A large proportion of short trips are made by car (Figure 2, (analysis of VISTA survey [@RN20])). Replacing short trips by walking and cycling would greatly contribute to reduce the high prevalence of physical inactivity observed in the adult population and the associated burden of diseases. 

This documents outlines the methods and data sources for the development of the quantitative health impact assessment model for the impacts of transport  scenarios on population health. The model was developed for metropolitan Melbourne and quantifies physical activity related health impacts of changes in transport from a range of scenarios where short trips made by car are replaced by walking and cycling. 


```{r, echo=FALSE, out.width="100%", fig.cap="Figure 1: Baseline mode of transport"}

img1=paste0(getwd(),"/SuppDocs/StagesGraphs/TripsModeBaseline.png")

include_graphics(img1)

```

```{r, echo=FALSE, out.width="100%", fig.cap="Figure 2: Baseline distance by mode of transport"}

img2=paste0(getwd(),"/SuppDocs/StagesGraphs/TripsModeDistCat.png")
include_graphics(img2)

```


# 2. Methods

The model analytic framework is depicted in Figure 1. The model consists of three main sections: 1) Scenarios; 2) Potential Impact Fractions; and 3) Proportional multi-state life table (PMSLT). The simulation starts with a change in physical activity for the population of interest. Changes in physical activity are informed by the transport scenarios. A change in physical activity, combined with the risk of diseases associated to it, is combined in the potential impact fraction (PIF) calculations to then modify incidence in the disease process (Proportional Multi-State Life Table). From each of the diseases process, data on changes in mortality and prevalence of diseases is collected to then modify overall mortality and prevalent years years lived with disability in the general life table. Outcomes by age (5-years) and sex cohort include: life years gained, health-adjusted life years gained, cause-specific cases of disease prevented and cause-specific deaths prevented. 

The  mathematical model used here was originally developed for the Assessing the Cost-Effectiveness in Prevention project (ACE-prevention) [@RN16] and later developments by the author [@RN26]. This version used here also borrows on developments for the Integrated Transport Health Impact Model (ITHIM) originally developed for the United Kingdom and later adoptions in other locations [@RN27]. 


```{r, echo = FALSE, fig.cap = 'Figure 3: Analytical Framework', out.height= "100%", out.width="100%"} 

### Size of output above and font in graph has to be adapted to output stylee (e.g. work, pdf, html)

analytical_framework <- grViz("digraph{
         
                   graph[rankdir = LR]
                     
                      # graph, node, and edge definitions
                      graph [compound = true, nodesep = .25, ranksep = 2.25,
                      color = black, overlap = true, fontsize = 10, fontname = Calibri]
                      
                      
                      node [fontname = Calibri, fontcolor = black,
                      shape = rectangle, fixedsize = false, width = 3.5,
                      color = DarkGray]

                      edge [color = DarkGray, arrowhead = none, arrowtail = none, tailport= E]

                         subgraph cluster_0 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          fontsize = 400
                          face = bold
                          fontname = Calibri
                          color = Gray
                         
                          label = 'Scenarios'
  
                            node[shape = rectangle, color = Black, margin = 0.25, fontsize = 400, style = dotted]
                            # 0[label = 'Physical activity']
                            1[label = 'Private car use']
                            2[label = 'Cycling']
                            3[label = 'Walking']
                            # 4[label = 'Public Transport'] 
                            
                            {rank = same;2;3} # 0;;4
                          
       }  
                          
                            subgraph cluster_1 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          fontsize = 400
                          fontname = Calibri
                          color = Gray
                          label = 'Potential impact fraction and risk'
                          
                                              subgraph cluster_10 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          fontsize = 400
                          fontname = Calibri
                          color = Gray
                          label = ''
                            
                             node[shape = rectangle, color = Black, margin = 0.25, fontsize = 400, style = dotted]
                            # 5[label = 'Ambient PM2.5']
                            # 6[label = 'On road PM2.5']
                            7[label = 'Physical activity']
                            # 8[label = 'Road trauma']
                          }   
                          
                          
                          subgraph cluster_11 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          fontsize = 400
                          fontname = Calibri
                          color = Gray
                          label = 'Relative risks'
                            
                            node[shape = rectangle, color = Black, margin = 0.25, fontsize = 400, style = dotted]
                            9[label = 'Ischemic heart disease']
                            10[label = 'Stroke']
                            # 11[label = 'COPD']
                            # 12[label = 'Lower respiratory infection']
                            13[label = 'Diabetes mellitus type 2']
                            14[label = 'Breast cancer']
                            15[label = 'Colon cancer']
                            16[label = 'Uterine cancer']
                          }
                            }
                            
                          subgraph cluster_2 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          fontsize = 400
                          fontname = Calibri
                          color = Gray
                          label = 'Proportional multi-state life table'
                             
                            node[shape = rectangle, color = Black, margin = 0.25, fontsize = 400, style = dotted]
                            17[label = 'Disease processes']
                            # 18[label = 'Injuries process']
                            19[label = 'Life table']
                            
                          }  
                                subgraph cluster_3 {
                           graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          fontsize = 400
                          fontname = Calibri
                          color = Gray
                          label = 'Outcomes'
                            
                            node[shape = rectangle, color = Black, margin = 0.25, fontsize = 400, style = dotted]
                            20[label = 'Cause-specific cases of diseases prevented']
                            21[label = 'Cause-specific deaths prevented']
                            # 22[label = 'Road trauma pYLDs']
                            # 23[label = 'Road trauma deaths']
                            
                            24 [label = 'Life years']
                            25[label = 'Health-adjusted life years']
                            #26[label = 'Life expectancy']
                            #27[label = 'Health-adjusted life expectancy']
                           } 
                            
                            edge[color = Black, arrowhead = normal, arrowsize = 1.25]
                          #0 -> 7
                          1 -> {2 3} # 4 5 6 8
                          2 -> 7 # 5 6 8
                          3 -> 7 # 5 6 8
                          # 4 -> 3 # 5 6 8
                          
                          
                          edge[color = DarkGray, arrowhead = normal, arrowsize = 1.25]
                          # {5 6} -> {9 10 11 12}
                          7 -> {9 10 13 14 15 16}
                          {9 10 13 14 15 16} -> 17  # 11 12
                          # 8 -> 18
                          # {17 18} -> 19
                          17 -> {20 21}
                          # 18 -> {22 23}
                          19 -> {24 25} #26 27
                          17 -> 19
                     }")

analytical_framework
tmp<-capture.output(rsvg_png(charToRaw(export_svg(analytical_framework)),'analytical_framework.png'))

```


## 2.2 Scenarios

Possible scenarios are outlined in Table 1 and consist of combinations of age groups, gender, distance to replace with walking or/and cycling and trip purpose to be replaced. The model always replaces car trips and distances replaced by walking and cycling are mutually exclusive. The maximum possible distance to be replaced with walking is 2 kilometers and 10 kilometers for cycling. Note that distances replaced correspond to stages of a trip, for example, a trip to work may include multiple stages including walking to train station, train ride, and from station to place of employment. Trip purposes were grouped into: all (Work related, education, leisure, shopping, pick-up or drop-off someone/something, personal business, other, accompany someone, education, at or go home) and commuting (work related and education).


```{r, echo=FALSE, include=TRUE}

scenarios <- tribble(
  ~"User input", ~"Options",
"Age",  "15 to 19, 20 to 39, 40 to 64, 65 plus, all",
"Gender", "female, male, all",
"Replace distance walking", "0 km, >=1km, >=2km", 
"Replace distance cycling", "0 km, 1-2km, >=2km, 3-5km, 6-10km, >=10km",
"Trip purpose", "All, Commuting")

pander(scenarios)
# kable(scenarios, booktabs = T, caption = "Table 1: Scenarios options", longtable = TRUE) %>%
# # column_spec(1:3, width = "15em") %>%
#   row_spec(0, bold = T) %>%
#   kable_styling()
```



## 2.1 Potential Impact Fraction

The potential impact fraction (PIF) measures the proportional change in the burden of disease attributable to a change in a related risk factor [@RN19]. PIFs in this model calculate the average change in incidence of diseases (Figure 3) in the scenarios' diseases' processes. PIFs were derived for: ischemic heart disease, stroke, type 2 diabetes, lung cancer, colon cancer, breast cancer and uterine cancer. The methods developed in the ITHIM-R [@RN27] project were used here to calculate individual level RRs for baseline (do nothing) and scenario which where then used to calculate individual level PIFs (\ref{eq1}).
From individual level PIFs, age group and sex average PIFs were calculated to modify incidence in the age and sex cohort disease processes' (Figure 3). Inputs for the PIFs' calculations are individual marginal metabolic of task per hour (mMET-hours) per week and disease relative risks. METs are metabolic equivalent of tasks and measure the energy expenditure required to carry out the physical activity, expressed as a multiple of the resting metabolic rate. Marginal METs only consider energy expended above resting metabolic rate.[@RN21]  All diseases have a threshold beyond which there are no benefits from increases in mMETs-hours, except for diabetes (35 mMET-hours for: colon, breast and uterine cancers, ischemic heart disease and stroke; 10 for lung cancer and 32 for stroke)(https://www.overleaf.com/project/5bc08a8caba5c52e6060b614). Figure 4 depicts relatives risks for each of the modeled diseases. Each individual has a baseline and scenario mMET-hours, where the scenario is modified by the additional walking or/and cycling attributable to the scenario. The derivation of mMET-hours is explained below. 





$$PIF_{disease} = { \frac{ { RR_{baseline} - RR_{scenario}}} {RR_{baseline}} }$$ 

**Relative risks**

Relative risks sources: https://shiny.mrc-epid.cam.ac.uk/meta-analyses-physical-activity/

```{r image_grobs, fig.show = "hold", echo=FALSE, out.width="20%", fig.cap="Figure 4: Relative risks for modelled diseases"}

file_name=paste0(getwd(),"/SuppDocs/RelativeRisks/")
RR<-list.files(file_name, pattern = ".png", full.names = TRUE)
include_graphics(RR)

```

Type 2 diabetes is a risk factor for ischemic heart disease and stroke, hence, we included the PIFs for stroke and ischemic heart disease of changes in diabetes using the relative risks from. [@RN29;@RN30]

$$PIF_{disease} = { \frac{ -({ Prevalence_{scenario} - Prevalence_{baseline}}) * (RR - 1)} {Prevalence_{baseline} * (RR -1) +1}  }$$ 
Where prevalence scenario is prevalence of type 2 diabetes after the intervention and baseline before the intervention and the RR is the relative risk for stroke or ischemic heart disease.

        
### PIF Combined

```{r, echo=FALSE, include=TRUE}
RR_diabetes <- tribble(
~"Disease", ~"Relative Risk (95% confidence interval)", ~"Sex",
"Ischemic heart disease", "2.82 (2.35, 3.38)", "Female", 
"Stroke", "2.28 (1.93, 2.69)", "Female",
"Ischemic heart disease", "2.16 (1.82, 2.56)", "Male", 
"Stroke", "1.83 (1.60, 2.08)", "Male",
 )
pander(RR_diabetes)
```


**mMET-hours**

A matched population was created to derive individual mMET-hours per week based on the **Victorian Integrated Survey of Travel and Activity 2017-2018** (VISTA 2017-18 @RN20) and the **National Health Survey, 2017-18, Basic CURF** (NHS, @RN22) physical activity data collected for surveillance. Physical activity data from the NHS were allocated to each VISTA individual. MET-hours per individual were derived from the sum of the product of hours spent weekly doing transport walking, transport cycling, vigorous PA for leisure, moderate PA for leisure and walking for leisure by their corresponding mMET-hours scores. Transport walking and cycling data were sourced from the VISTA survey. The matching process is depicted in Figure 5, briefly, sampled individuals from NHS were randomly allocated to VISTA people based on age, sex, socio-economic status, whether they walk for transport, whether they walked at least 2 hours per week for transport and whether they worked. 




```{r, echo = FALSE, fig.cap = 'Figure 5: Analytical Framework mMET-hours', out.width = "100%", out.height="100%" } 
### This graph needs some work! basics are here

analytical_framework_METs <- grViz("digraph{
         
                      graph[rankdir = LR, compound = true, nodesep = 5, ranksep = 10,
                      color = black, overlap = true, height = 400, width = 400, fontsize = 400]
                      
                      node[fontname = Calibri, fontcolor = black,
                      shape = rectangle, width = 5,
                      color = Black, fontsize = 400, align=centered]

                      edge[color = Black, arrowhead = normal, arrowtail = none, tailport= 'e', headport= 'w']
                      
                         subgraph cluster_0 {
                          style = rounded
                          bgcolor = WhiteSmoke
                          face = bold
                          color = Black
                          label = 'Data sources'
                          
                            1[label = 'VISTA 2017-2018', fontsize = 400]
                            2[label = 'NHS 2017-18, Basic CURF', fontsize = 400]
                            3[label = 'SEIFA INDEX', fontsize = 400]
                            
                         }  
                         subgraph cluster_1 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          face = bold
                          color = Black
                          label = 'Data used'
  
                            4[label = 'Households', fontsize = 400]
                            5[label = 'Persons', fontsize = 400]
                            6[label = 'Trips', fontsize = 400]
                            7[label = 'Households', fontsize = 400]
                            8[label = 'Person', fontsize = 400]
                            9[label = 'SES', fontsize = 400]
                            
                   {rank = same; 4;5;6;7;8;9}
                
                         }   
                       
                       subgraph cluster_2 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          face = bold
                          color = Black
                          label = 'Generated data sets to match'
  
                            
                            10[label = 'Persons transport (n=7,117)', fontsize = 400]
                            11[label = 'Persons Leisure and work (n=16,370)', fontsize = 400]
            
                            
                           {rank = same; 10;11}
     
                       }
                       
                          subgraph cluster_3 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          face = bold
                          color = Black
                          label = 'Matching variables'
                            
                            12[label = 'Age group', fontsize = 400]
                            13[label = 'Sex', fontsize = 400]
                            14[label = 'SES', fontsize = 400]
                            15[label = 'Walk for transport (yes/no)']
                            16[label = 'Walk min for transport']
                            17[label = 'Work status']

                            
                           {rank = same; 12;13;14;15;16;17}
     
                          }
                          
                          subgraph cluster_4 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          face = bold
                          color = Black
                          label = ''
                            
                            18[label = 'mMET-hours per person', fontsize = 400]

                           {rank = same; 12;13;14;15;16;17}
     
                          }
                       
                         edge[color = Black, arrowhead = normal, arrowsize = 10, penwidth = 5]             
                         
                          1 -> {4 5 6}
                          2 -> {7 8}
                          3 -> 9
                          {4 5 6 9} -> 10
                          {7 8} -> 11
                          {4 5}  3
                          10 -> 14 [ltail= cluster_2,lhead= cluster_3];
                          11 -> 14 [ltail= cluster_2,lhead= cluster_3];
                          14 -> 18 [ltail= cluster_3,lhead= cluster_4];
                          
                   }")
       

analytical_framework_METs

tmp<-capture.output(rsvg_png(charToRaw(export_svg(analytical_framework_METs)),'analytical_framework_METs.png'))

```



**MET scores**

MET scores to derive mMET-hours per person were derived from the Compendium of physical activities minus one [@RN21]. 

```{r, echo=FALSE, include=TRUE}
mets <- tribble(
~"Physical activity", ~"Survey", ~"mMETs", 
"Walking for transport", "VISTA 2017-18", "2.53 (1.1)", 
"Cycling for transport", "VISTA 2017-18", "4.63 (1.2)",
"Walk for leisure", "NHS 2017-18", "2.53 (1.1)",
"Moderate PA", "NHS 2017-18", "3.5",
"Vigorous PA", "NHS 2017-18", "7",
 )
# kable(mets, booktabs = T, caption = "Table 2: mMETS-hr", longtable = TRUE) %>%
# column_spec(1:1, width = "15em") %>%
#   row_spec(0, bold = T) %>%
#   kable_styling()

pander(mets)
```

**Victorian Integrated Travel and Activity Survey**

The latest VISTA survey conducted across the period 2017-18 for Greater Melbourne and Geelong was used. Randomly selected households were asked to complete the household form and each individual to complete a travel diary for a single specified day (or adult for children). The survey aims to capture average travel behavior. The Greater Melbourne data includes 3,543 households, 7,117 individuals and 23,166 trips. Travel data was collected for all households' persons above the age of 5. We limited the analysis to individuals over the age of 16. The travel diary asked respondents about travel and activities on a particular travel day, specifically: 
1) all travel over the whole day, from 4:00 am on the travel day until 4:00 am the next day,
2) all trips to be included, even short trips (like walking to lunch or going for a jog), and
3) includes people who do not travel on the travel survey day. 

From the VISTA survey we obtained time and distance spent by mode of travel per week. We created time and distance variables per person by adding up all stages time and distance by mode in a trip. A trip may have up to 9 stages. The data is for one day, and the survey indicates whether travel occurred on a weekday or weekend day. We derived a week total time and distance by mode by multiplying by 7.

**National Health Survey**

The **NHS** is a representative sample of Australian adults (>=15 years of age). The data were collected by the Australian Bureau of Statistics and published as the National Health Survey, 2017-18, Basic-CURF [@RN22]. A sample of 21,315 adults was available. Survey respondents were asked about the time they spent doing exercise (for leisure or walking for transport) and workplace physical activity in the last week. Table 2 outlines types of physical activity data collected in the NHS.

```{r, echo=FALSE, include=TRUE}

pa_NHS_collected_data <- tribble(
~"Type of activity", ~"Definition",
"Walking for fitness, recreation and sport", "Must have carried out for at least 10 minutes continuously", 
"Walking to get from place to place", "1) Excludes activities such as walking around a shopping center as people tend to frequently pause while shopping. 2) Must have carried out for at least 10 minutes continuously.", 
"Moderate intensity exercise", "1) Comprises activities that caused a moderate increase in the heart rate or
breathing of the respondent (e.g. gentle swimming, social tennis, golf). 2) Excludes any previously identified walking as well as household chores, gardening or yard work, and any activity carried out as part of a job", 
"Vigorous intensity exercise", "1) Comprises activities that caused a large increase in the respondent's
heart rate or breathing (e.g. jogging, cycling, aerobics, competitive tennis). 2) Excludes any previously identified walking as well as household chores, gardening or yard work, and any activity carried out as part of a job",
"Strength or toning exercises", "1) Activities designed to increase muscle strength or tone, such as lifting
weights, resistance training, pull-ups, push-ups, or sit ups. 2) Includes any Strengthening and toning exercises activities already mentioned",
"Workplace physical activity", "1) Usual physical activity while at work on a typical work day. 2) Must have carried out for at least 10 minutes continuously. 3) Moderate activity in the workplace was defined as activity that caused a moderate increase in the heart rate or breathing of the respondent (e.g. brisk walking or carrying light lights). 4) Vigorous activity in the workplace was defined as activity that caused a large increase in heart rate or breathing (e.g. carrying or lifting heavy loads, digging or construction work)")

# kable(pa_NHS_collected_data, booktabs = T, caption = "Table 3: NHS PA variables", longtable = TRUE) %>%
# column_spec(1:1, width = "15em") %>%
#   row_spec(0, bold = T) %>%
#   kable_styling()

pander(pa_NHS_collected_data)
```


## Proportional multi-state life table

The PMSLT is a population level model (macro) approach to simulate health impacts of changes in exposure to health risk factors (e.g. physical inactivity, air pollution and diet). The PMSLT has been widely used to simulate outcomes for population level interventions for the reduction risks for chronic diseases. Figure 6 is an schematic representation of the PMSLT. The two main PMSLT components are the disease life tables (for each of the modelled diseases) and a general life table. Each disease life tables is calculated for baseline and scenarios.
The seven included diseases are modeled applying a set of differential equations to describe the transition between four states (healthy, diseased, dead from the disease and dead from all other causes) [@RN18]. Transition probabilities among the four states are based on rates of incidence, remission, case fatality and background mortality. A change in exposure to the risk factors of interest (physical activity modifies incidence via the potential impact fraction (PIF). To simplify the process, remission is set to zero. 


\blandscape

```{r, echo = FALSE, fig.cap = 'Figure 6: Analytical Framework', out.height= "200%", out.width="100%"} 
### This graph needs some work! basics are here

PMSLT_graph <- grViz("digraph{
         
                   graph[rankdir = LR]
                     
                      # graph, node, and edge definitions
                      graph [compound = true, nodesep = 5, ranksep = 10,
                      color = black, overlap = true]
                      
                      node [fontname = Calibri, fontcolor = black,
                      shape = rectangle, fixedsize = false, width = 2,
                      color = Black, fontsize = 200]
                      
                      edge[color = Black, arrowhead = normal, arrowtail = none, tailport= 'e', headport= 'w']
                      
                      
                      ### Life tables subgroup
                      #### Graph cluster with BAU and Intervention Life table
                      
                          subgraph cluster_0 {
                           graph[shape = rectangle, rankdir=LR]
                           style = rounded
                           bgcolor = WhiteSmoke
                           fontsize = 200
                           face = bold
                           fontname = Calibri
                           color = Gray
                            label = '' 
                     
                          
                      ##### Life table graph BAU    
                          subgraph cluster_1 {
                          graph[rankdir = LR]
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          fontsize = 200
                          face = bold
                          fontname = Calibri
                          color = Gray
                         
                          label = 'Life Table BAU'
  
                            node[shape = rectangle, color = Black, margin = 0.25, fontsize = 200, style = dotted, group = right]
                            edge[color = Black, arrowhead = normal, arrowsize = 10, penwidth = 5] 
                            1[label = 'mx']
                            2[label = 'qx']
                            3[label = 'lx']
                            4[label = 'Lx']
                            5[label = 'pyldx']
                            6[label = 'Lwx']
                            1 -> 2 ->3 ->4;
                            4 -> 6;
                            5 -> 6
                         }
                            

                          ##### Life table graph Intervention 
                          subgraph cluster_2 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          fontsize = 200
                          face = bold
                          fontname = Calibri
                          color = Gray
                         
                          label = 'Life Table intervention'
  
                            node[shape = rectangle, color = Black, margin = 0.25, fontsize = 200, style = dotted, group = right]
                            edge[color = Black, arrowhead = normal, arrowsize = 10, penwidth = 5] 
                            7[label = 'mx']
                            8[label = 'qx']
                            9[label = 'lx']
                            10[label = 'Lx']
                            11[label = 'pyldx']
                            12[label = 'Lwx']
                            7 -> 8 ->9 ->10;
                            11 -> 12[ dir = back ];
                            10 -> 12
                     
                              }
            
                          }
                        ### Disease life table subgroup    
                          subgraph cluster_3 {
                           graph[shape = rectangle]
                           style = rounded
                           bgcolor = WhiteSmoke
                           fontsize = 200
                           face = bold
                           fontname = Calibri
                           color = Gray
                            label = '' 
                            
                            
                            
                          subgraph cluster_4 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          fontsize = 200
                          fontname = Calibri
                          color = Gray
                          label = 'Disease life table BAU'
                            
                            node[shape = rectangle, color = Black, margin = 0.25, fontsize = 200, style = dotted, group = left]
                            edge[color = Black, arrowhead = normal, arrowsize = 10, penwidth = 5] 
                            13[label = 'ix']
                            14[label = 'px']
                            15[label = 'mx']
                            16[label = 'w']
                            17[label = 'pylds']
                            13 -> 14 -> 15;
                            14 -> 17; 
                            16 -> 17
                            
                          }

                          subgraph cluster_5 {
                          graph[shape = rectangle]
                          style = rounded
                          bgcolor = WhiteSmoke
                          fontsize = 200
                          fontname = Calibri
                          color = Gray
                          label = 'Disease life table intervention'
                          
                            node[shape = rectangle, color = Black, margin = 0.25, fontsize = 200, style = dotted, group = left]
                            edge[color = Black, arrowhead = normal, arrowsize = 10, penwidth = 5] 
                            18[label = 'ix']
                            19[label = 'px']
                            20[label = 'mx']
                            21[label = 'w']
                            22[label = 'pylds']
                            18 -> 19 -> 20;
                            19 -> 22;
                            21 -> 22; 
                            
                          }}
    
                          subgraph cluster_7 {
                           graph[shape = rectangle, rankdir=LR]
                           style = rounded
                           bgcolor = WhiteSmoke
                           fontsize = 200
                           face = bold
                           fontname = Calibri
                           color = Gray
                     
                           label = 'Difference intervention and BAU'
                     
                             node[shape = rectangle, color = Black, margin = 0.25, fontsize = 200, style = dotted, group = right]
                             edge[color = Black, arrowhead = normal, arrowsize = 10, penwidth = 5] 
                             27[label = 'mx']
                             28[label = 'pyldx']
                
                          }

  
                   
                     edge[color = Black, arrowhead = normal, arrowsize = 10, penwidth = 5]  
                   
                   
                    {15 20} -> 27 
                    {17 22} -> 28 
                    27 ->7
                    28 -> 11
                     
                     }")

PMSLT_graph

tmp<-capture.output(rsvg_png(charToRaw(export_svg(PMSLT_graph)),'PMSLT_graph.png'))
```

\elandscape

*Data inputs*

Data inputs for the proportional multi-state life table model (PMSLT) include inputs for: general life table (population, mortality rates and prevalent years lived with disability rates for all causes (YLD)), diseases processes (incidence and case fatality) and injuries process (mortality rates and years lived with disability rates). Here we prepared inputs for the Melbourne population, when local inputs were available, these were used, otherwise, we used state or nationally representative inputs. Table 1 describes all data inputs for the MSLT. Each of the MSLT components and related code are explained below Table 1.

```{r, echo=FALSE, include=TRUE}

pmslt_inputs <- tribble(
~Component, ~"Data needs", ~"Input data", ~"Data processing",
"General life table", "Population numbers and mortality rates", "Population Greater Melbourne [@RN2] by 5-year age groups and sex and death rates by single year of age and sex [@RN11]", "Population data is from the ABS 2016 Census. Mortality rates are for Victoria given that future projections for mortality were available for Victoria and not for Melbourne. Deaths rates projections were available by 1-year age intervals and sex from 2017 (baseline to 2066)", 
"General life table", "All-cause YLDs", "Global Burden of Disease (GBD) study by 5-year age groups and sex [@RN8]", "GBD data is in five-year age groups, interpolation to derive one-year age groups", 
"Disease process", "Disability weights, incidence and case fatality", "Disability weights were derived from disease specific YLDs [@RN8] and prevalence [@RN8]. Incidence and case fatality were derived using DISMOD II  and ", "Table 2 outlines DISMOD II data processing and data inputs. Disability weights were calculated by dividing disease specific YLDs by prevalence and adjusted by all cause YLDs",
"Diseases trends", "Future trends to apply to incidence and case fatality", "Trends cancers: incidence [@RN3], mortality [@RN4]. Trends for cardiovascular diseases, diabetes and chronic obstructive pulmonary disease were not available. These were derived from past data [@RN5; @RN6; @RN7]", "Explained in sections Trends"
)
# kable(pmslt_inputs, booktabs = T, caption = " Table 4: PMSLT inputs", longtable = TRUE) %>%
# 
#   column_spec(1:2, width = "7em") %>%
#   column_spec(3:4, width = "15em") %>%
#   row_spec(0, bold = T)  %>%
#   kable_styling()
pander(pmslt_inputs)
```


### Disease processes: disability weights

Disability weights (DW) are derived from disease specific prevalent years lived with disability (YLD) and disease specific prevalence by age group (5 years) and sex. Data for YLDs prevalence from GBD data for 2017. An age and sex specific-correction was introduced to counteract the effects of accumulating comorbid illnesses in the older age groups (Equation 1). Interpolation was used to derive rates per single year of age from 5-year age intervals rates.


$$DW_{adjusted} = { { \frac{ { \frac{ { {YLD_{disease}}}} {P_{disease}} } } {1 - YLD_{total}}}} $$ 

\frac{4z^3}{16}

Where YLDd is the YLD mean number per age and sex for a given disease, Pd is the prevalence (as reported in GBD )  for a given disease by age and sex and YLDt is total YLD rate per age and sex. 


### Disease processes: incidence and case fatality

We used AIHW incidence and mortality cancer data for 2017 for Australia and GBD data for Australia for other diseases for the year 2017 to derive incidence and case fatality inputs for breast cancer (females), colon cancer, lung cancer, uterine cancer (females), ischemic heart disease, stroke, type 2 diabetes and chronic pulmonary disease.

We used Dismod II (free at https://www.epigear.com/index_files/dismod_ii.html) to derive internally consistent inputs for incidence and case fatality and generate missing data. For example, the GBD studies provide data for incidence, prevalence and disease mortality, however, not case fatality. For cancers we used AIHW given that the GBD data was derived assuming remission for cancers (except for long life sequelaes) (@RN10), but in our model we assumed no remission for diseases. In addition, AIHW generates data for colon cancer and lung cancer, while the GBD only provides estimates for larger disease groups (colon and rectum cancer and tracheal, bronchus, and lung cancer). Dismod II is a separate tool, therefore, here, we provide information relating to any data processing of the original data. 


```{r,echo=FALSE, message=FALSE, warning=FALSE}

dismod_process <- tribble(
~"Disease", ~"Collection data", ~"Disease inputs", ~"ICD-10 codes", ~"Process", 
"Chronic obstructive pulmonary disease", "Population and mortality rates (TO DO: Belen check)", "Incidence, prevalence and mortality (@RN8)", "J41-J42.4, J43-J44.9", "Remission set to zero", 
"Diabetes mellitus type 2", "Population and mortality rates (TO DO: Belen check)", "Incidence, prevalence and mortality (@RN8)", "E08-E08.11, E08.3-E08.9, E12-E12.1, E12.3-E13.11, E13.3-E14.1, E14.3-E14.9, R73-R73.9 (all diabetes)", "Remission set to zero",
"Ischemic heart disease", "Population and mortality rates (TO DO: Belen check)", "Incidence, prevalence and mortality (@RN8)", "I20-I21.6, I21.9-I25.9, Z82.4-Z82.49", "Remission set to zero and higher weight to prevalence (half bar)", 
"Stroke", "Population and mortality rates (TO DO: Belen check)", "Incidence, prevalence and mortality (@RN8)", "G45-G46.8, I60-I62, I62.9-I64, I64.1, I65-I69.998", "Remission set to zero and higher weight to prevalence input (half bar)",
"Breast cancer (females)", "Population and deaths data for Australia (@RN1)", "Incidence and mortality (@RN3)", "C50", "Remission set to zero", 
"Uterine cancer (females)",  "Population and deaths data for Australia (@RN1)", "Incidence and mortality (@RN3)", "C54–C55", "Remission set to zero", 
"Colon cancer",  "Population and deaths data for Australia (@RN1)", "Incidence and mortality (@RN3)", "C18", "Remission set to zero", 
"Lung cancer",  "Population and deaths data for Australia (@RN1)", "Incidence and mortality (@RN3)", "C33–C34", "Remission set to zero"
)

# kable(dismod_process , booktabs = T, caption = "Table 5: Dismod II input data and procedures") %>%
#  kable_styling(latex_options = c("hold position", "repeat_header"),
#                full_width = F)%>%
#   column_spec(1, width = "5em") %>%
#   column_spec(2:5, width = "8em") %>%
#   row_spec(0, bold = T)

pander(dismod_process)

```

#### Calculate diseases trends 

Table 3 outlines methods used to derive diseases' trends.

```{r,echo=FALSE, message=FALSE, warning=FALSE}

trends_diseases <- tribble(
~"Input", ~"Inputs", ~"Assumptions", ~"Data processing",
"Disease life table: incidence cancers", "@RN3 forecast from 2017 to 2020", "Same above", "We derive an annual trend as the log difference between the age standardised rate in 2020 and 2017 divided by the diffence in years",
"Disease life table: case fatality cancers", "@RN4 forecast from 2014 to 20
for mortality", "Same above", "Same above",
"Disease life table: cardiovascular diseases incidence", "@RN5 hospitalization past trends (actual data) from years 2001 to 2018", "Same above and forecast trends were applied to ischemic heart disease and stroke", "Future Age standardized rates (ASR) were freest derived from ASR from past trends by sex using linear regression for predominately increasing trends and log-linear regression for decreasing trends. Trends were estimated up to year 2023. Annual trends were derived as above (ln(ASR2023/ASR2018)/years)", 
"Disease life table: cardiovascular disease case fatality", "@RN5 mortality past trends (actual data) from years 2001 to 2018", "Same above and forecast trends were applied to ischemic heart disease and stroke", "Future Age standardized rates (ASR) were first derived from ASR from past trends by sex using linear regression for predominately increasing trends and log-linear regression for decreasing trends. Trends were estimated up to year 2023. Annual trends were derived as above (ln(ASR2023/ASR2018)/years)",
"Disease life table: diabetes incidence", "@RN6 mortality past trends from years 1997 to 2023 for diabetes as the underlying or associated cause of death", "Same as above and trends only applied to incidence", "Same as above with forecast up to year 2023", 
"Disease life table: Chronic obstructive pulmonary disease incidence", "@RN7 mortality past trends from year 2005 to 2018", "Same as above", "Same as above"
)

# kable(trends_diseases, booktabs = T, caption = "Table 6: Forecast trends for diseases") %>%
#  kable_styling(latex_options = c("repeat_header", "hold position"),
#                full_width = F)%>%
#   column_spec(1:3, width = "8em") %>%
#   column_spec(4, width = "14em") %>%
#   row_spec(0, bold = T)
pander(trends_diseases)
```

# 3. References

